## 02｜基础篇：到底应该怎么理解“平均负载”

uptime 最后三个数是什么？

1，5，15 分钟平均负载，什么是平均负载？

简单来说，就是指单位时间内，系统处于可运行状态和不可中断状态的平均进程数，也就是平均活跃进程数。（它跟 CPU 使用率没有直接关系。）

可运行状态，是指正在使用 CPU 或者正在等待 CPU 的进程，也就是通过 ps 命令看到的处于 R 状态的进程。

不可中断状态的进程是指正处于内核态关键流程中的进程，并且这些流程是不可打断的，比如等待硬件设备 IO 响应，ps 命令看到的 D 状态（Uninterruptible Sleep，也称为 Disk Sleep ）的进程。

不可中断状态实际上是系统对进程和硬件设备的一种保护机制。

多问自己几个为什么，以求能够彻底理解现象背后的本质原理，用起来更灵活，也更有底气。

平均负载最理想的情况是等于 CPU 个数，所以我们在评判平均负载时，首先我们要知道系统有几个 CPU

当平均负载高于 CPU 数量 70% 我门就应该去分析排查负载高的问题。但是数值不是绝对的，只是个参考，最好是监控起来，看图表趋势。

平均负载案例分析工具：iostat，mpstat，pidstat

mpstat 是一个常用的多核 CPU 性能分析工具，用来实时查看每个 CPU 的性能指标，以及所有 CPU 的平均指标。

pidstat 是一个常用的进程性能分析工具，用来实时查看进程的 CPU、内存、I/O 以及上下文切换等性能指标。

stress 是一个 Linux 系统压力测试工具，这里我们用作异常进程模拟平均负载升高的场景。

每个进程等待 CPU 的时间（%wait列）

平均负载看了这么多，是不是一定是负载高就有问题呢？也不一定，因为你的程序可能是 CPU 密集型的，平均负载高不一定代表 CPU 使用率高，还可能是io繁忙。负载高时，你可以使用mpstat，pidstat 工具辅助分析负载的原因。

### 命令

man uptime

top （/proc/cpuinfo）

apt install stress sysstat

watch -d uptime

stress -cpu 1 —timeout 600

mpstat -P ALL 5 1

pidstat -u 5 1

stress -i 1 —timeout 600

stress -c 8 —timeout 600

### 面试题

什么是平均负载？

平均负载多少合理？

生产环境，平均负载多高时，需要我们重点关注？

/proc/cpuinfo? 里面的参数详解

### 专栏金句

全局观举例：初秋时北京的天气，如果我们只看中午的温度，您可能还以为在 7 月份的夏天，但是你结合了早上、中午、晚上三个时间点的温度来看，基本可以全方位的了解一天的天气情况了。

### 精选留言