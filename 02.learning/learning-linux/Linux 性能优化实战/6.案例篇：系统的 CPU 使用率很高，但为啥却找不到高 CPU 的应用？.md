## 06 | 案例篇：系统的 CPU 使用率很高，但为啥却找不到高 CPU 的应用？

## 笔记

工具：

pstree，用树状形式显示所有进程之间的关系。

pstree | grep stress

perf record -g 记录性能事件，然后使用 perf report 查看

execsnoop是一个专为短时进程设计的工具，通过 ftrace 实时监控进程的 exec() 行为，并输出短时进程的基本信息，包括进程 PID，父进程 PID，命令行参数以及执行的结果。

### 发现面试题

pid 一直在变，说明什么？

- 要么是进程不停地重启（可能遇到了段错误、配置错误）
- 要么就是全新的进程。（短时进程，在其他应用内部通过 exec 调用的外面命令。它只运行很短的时间就会结束，top命令间隔比较长，所以很难监控看到。

短时应用导致的问题，会有哪些可能性？

- 应用里直接调用了其他二进制程序，这些程序通常运行时间比较短，通过 top 等工具不容易发现。
- 应用本身在不停地崩溃重启，而启动过程的资源初始化，很可能会占用相当多的CPU。

### 专栏金句

当你发现系统的 CPU 使用率很高的时候，不一定能找到相对应的高 CPU 使用率的进程。

父亲应该一直对儿子负责，善始善终，如果不作为或者跟不上，都会导致“问题少年”的出现。

### 精选留言