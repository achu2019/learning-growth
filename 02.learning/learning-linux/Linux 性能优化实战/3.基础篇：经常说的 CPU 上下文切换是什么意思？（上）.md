## 03 | 基础篇：经常说的 CPU 上下文切换是什么意思？（上）

## 笔记

CPU 寄存器和程序计数器（Program Counter, PC）

CPU 寄存器是 CPU 内置的容量小、但速度极快的内存。而程序计数器，则是用来存储CPU正在执行的指令位置、或者即将执行的下一条指令位置。他们被称为CPU上下文。（因为他们是 CPU 在运行任务前，必须依赖的环境）

CPU 上下文切换分为几个不同的场景：进程上下切换、线程上下文切换，中断上下文切换。

进程的运行空间分为：内核空间和用户空间。分别对应 CPU 特权等级 Ring 0 和 Ring 3

- 内核空间（Ring 0）具有最高权限，可以直接访问所有资源。
- 用户空间（Ring 3）只能访问受限资源，不能直接访问内存等硬件设备，必须通过系统调用陷入到内核中，才能访问这些特权资源。

进程的用户态，进程的内核态。

系统调用通常称为特权模式切换，而不是上下文切换。

- 进程上下文切换，是指从一个进程切换到另一个进程运行。
- 系统调用过程中一直是同一个进程在运行。

线程上下文切换

线程是调度的基本单位，而进程则是资源拥有的基本单位。

中断上下文切换

中断上下文，只保存内核态中断服务程序执行所必需的状态，包括 CPU 寄存器、内核堆栈、硬件中断参数等。

对同一个CPU来说，中断处理比进程拥有更高的优先级。

## 发现面试题：

进程在竞争 CPU 时并没有真正运行，为什么还会导致系统的负载升高呢？（答案：CPU 上下文切换就是罪魁祸首。）

为什么更新 CPU 寄存器的值，会影响系统的 CPU 性能呢？不是寄存器本身就是为了快速运行任务而设计的吗？

CPU 上下文切换分为哪些场景？进程上下文切换、线程上下文切换，中断上下文切换。

一次系统调用的过程，其实是发生了两次 CPU 上下文切换。（所以，我们经常都在说要减少系统调用，也就是为了减少CPU上下文切换吧）

进程上下文切换跟系统调用有什么区别呢？

## 专栏金句：

## 微信群交流总结：

## 发现专栏精选留言：

进程切换我想到了很多年前在银行柜台办理业务的情形。

1：银行分配各个窗口给来办理业务的人

2：如果只有1个窗口开放（系统资源不足），大部分都得等

3：如果正在办理业务的突然说自己不办了（sleep）,那他就去旁边再想想（等）

4：如果突然来了个VIP客户，可以强行插队

5：如果突然断电了（中断），都得等。。